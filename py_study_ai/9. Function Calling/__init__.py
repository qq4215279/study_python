"""
9-Function Calling与协作

Function Calling在大模型中的作用是什么？
1. 扩展模型能力
    大模型本身无法直接操作外部系统（如数据库、计算工具），但通过调用预设函数，可以完成：
    实时数据获取（天气、股价、新闻）
    复杂计算（数学运算、代码执行）
    操作外部系统（发送邮件、控制智能设备）
2. 结构化输出
    模型可将用户自然语言请求转化为结构化参数，传递给函数。例如：
    用户说“明天北京天气如何？” → 模型调用 get_weather(location="北京", date="2025-05-06")
3. 动态决策流程
    模型可根据上下文决定是否/何时调用函数，甚至链式调用多个函数（如先查天气，再推荐穿搭）。
        Function Call是大模型与真实世界交互的“桥梁”，从语言理解 => 具体行动

Function Calling与MCP的区别？
维度                  Function Calling                                    MCP
定位              模型厂商私有接口（如OpenAI, Qwen）          开放协议（类似 HTTP/USB-C）
扩展性            需为每个模型单独适配                        一次开发，多模型兼容
复杂性            适合简单、单次调用任务                      支持多轮对话、复杂上下文管理
生态依赖          依赖特定模型（如 GPT-4）                    跨模型、跨平台（如 Claude、Cursor）
安全性            依赖云端 API 密钥                          支持本地化数据控制


已经有了MCP还需要Function Calling么？
简单、原子化任务使用Function Calling会更方便
1. 查询天气 get_weather(city="北京")
2. 计算数学公式 calculate(expression="3+5")
3. 发送单条通知 send_email(to="user@example.com")
优势：
    开发快捷：无需配置 MCP Server，直接通过模型 API 调用预定义函数。
    低延迟：单次请求-响应，无需协议层开销。
MCP 可能成为主流，但 Function Calling 作为底层能力仍将存在


Function call是否需要微调？
通常大模型具备Function Call的能力，但有时候针对特定的Function Call理解和提参能力不强 => 可以微调
Function Call 的微调目标，是教会模型下面两件事：
• 判断是否需要调用函数（比如“查天气”需要，而“写首诗”不需要）。
• 正确提取参数并生成格式化的调用指令（比如转成JSON）。

微调的步骤是怎样的？
Step1，准备数据
输入：用户问题（如“北京今天天气？”）。
函数描述：告诉模型有哪些函数可用（比如get_weather(city, date)）。
期望输出：
• 需要调用时：生成JSON格式的函数调用（如{"name":"get_weather", "arguments":{"city":"北京", "date":"今天"}}）。
• 不需要时：直接生成回答（如“你好，今天星期一...”）。
Step2，模型训练
选一个擅长理解指令的预训练模型，如Qwen。
用上述数据训练模型，让它学会“根据问题和函数描述，决定是否调用函数，并生成正确格式”。

Function Call微调的关键点：
• 数据质量：需覆盖各种场景（需要/不需要调用、参数变化等）。
• 函数描述要清晰：模型靠描述理解函数用途。
• 避免误触发：加入足够多“无需调用”的样本，防止模型滥用函数。
"""